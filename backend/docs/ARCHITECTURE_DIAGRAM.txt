â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                   HEXAGONAL ARCHITECTURE: PORTS & ADAPTERS PATTERN                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                                    [APPLICATION LAYER]

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  CREATE TRANSACTION USE CASE                                         â”‚
    â”‚                                                                       â”‚
    â”‚  - Validates product exists      (via IProductsRepository)          â”‚
    â”‚  - Charges payment               (via IPaymentPort)                 â”‚
    â”‚  - Sends receipt email           (via INotificationPort)            â”‚
    â”‚  - Creates delivery              (via IDeliveriesRepository)        â”‚
    â”‚                                                                       â”‚
    â”‚  Domain logic is DECOUPLED from external concerns âœ“                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â–²
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                     â”‚                     â”‚
                    â–¼                     â–¼                     â–¼

         [PORT 1: Data Access]  [PORT 2: Payment]   [PORT 3: Notification]

    IProductsRepository         IPaymentPort        INotificationPort
    IDeliveriesRepository       (abstract)          (abstract)
    (abstract)                     â”‚                    â”‚
       â”‚                           â”‚                    â”‚
       â”‚                           â”‚                    â”‚
    â”Œâ”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚             â”‚            â”‚   â”‚   â”‚            â”‚            â”‚
    â–¼             â–¼            â–¼   â–¼   â–¼            â–¼            â–¼

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ PRISMA   â”‚ â”‚ TYPEORM  â”‚ â”‚ MONGODB  â”‚ â”‚ WOMPI    â”‚ â”‚ SENDGRID â”‚
  â”‚ ADAPTER  â”‚ â”‚ ADAPTER  â”‚ â”‚ ADAPTER  â”‚ â”‚ ADAPTER  â”‚ â”‚ ADAPTER  â”‚
  â”‚ (Concrete)                    â”‚  (Concrete)     â”‚ (Concrete)
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚             â”‚             â”‚           â”‚            â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
         [EXTERNAL SERVICES]

         PostgreSQL     MongoDB     Wompi API     SendGrid API
         (Real DB)      (Real DB)    (Real API)    (Real Service)


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                               PORT & ADAPTER EXAMPLE                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SCENARIO: Change email provider from SendGrid to AWS SES

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BEFORE (Without Ports & Adapters)                              â”‚
â”‚                                                                 â”‚
â”‚ SendTransactionReceiptUseCase                                  â”‚
â”‚   â”œâ”€ const sgMail = require('@sendgrid/mail')                  â”‚
â”‚   â”œâ”€ const response = sgMail.send({ ... })                    â”‚
â”‚   â””â”€ return result                                              â”‚
â”‚                                                                 â”‚
â”‚ Problem: If we change to AWS SES, we must modify this code âœ—  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AFTER (With Ports & Adapters)                                  â”‚
â”‚                                                                 â”‚
â”‚ SendTransactionReceiptUseCase                                  â”‚
â”‚   â””â”€ await this.notificationPort.sendEmail(input)             â”‚
â”‚      // ^ No knowledge of SendGrid or AWS SES!                â”‚
â”‚                                                                 â”‚
â”‚ EmailNotificationAdapter (Infrastructure)                      â”‚
â”‚   â””â”€ implements INotificationPort                              â”‚
â”‚   â””â”€ async sendEmail() {                                       â”‚
â”‚       return await sgMail.send({ ... })  // SendGrid           â”‚
â”‚      }                                                          â”‚
â”‚                                                                 â”‚
â”‚ AwsNotificationAdapter (Infrastructure)                        â”‚
â”‚   â””â”€ implements INotificationPort                              â”‚
â”‚   â””â”€ async sendEmail() {                                       â”‚
â”‚       return await sesClient.sendEmail({ ... })  // AWS        â”‚
â”‚      }                                                          â”‚
â”‚                                                                 â”‚
â”‚ To swap: Just change 1 line in TransactionsModule âœ“            â”‚
â”‚   {                                                             â”‚
â”‚     provide: INotificationPort,                                â”‚
â”‚     useClass: AwsNotificationAdapter,  // â† Changed            â”‚
â”‚   }                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        WHAT YOU ADDED TODAY                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ INotificationPort (domain/ports/)
  â””â”€ abstract sendEmail() â† Domain doesn't care about implementation

âœ“ EmailNotificationAdapter (infrastructure/adapters/)
  â””â”€ implements INotificationPort â† Concrete SendGrid logic here

âœ“ SendTransactionReceiptUseCase (application/use-cases/)
  â””â”€ constructor(private notificationPort: INotificationPort)
  â””â”€ Uses port without knowing about external services âœ“

âœ“ Updated TransactionsModule
  â””â”€ Registered: { provide: INotificationPort, useClass: EmailNotificationAdapter }

Result: +10 Bonus Points for Hexagonal Architecture! ğŸ¯


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    NEXT PORTS TO ADD (OPTIONAL)                                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. LOGGING PORT
   â”œâ”€ domain/ports/logger.port.ts
   â”œâ”€ infrastructure/adapters/winston-logger.adapter.ts
   â””â”€ Swap Winston â†’ Pino â†’ Console easily

2. CACHING PORT
   â”œâ”€ domain/ports/cache.port.ts
   â”œâ”€ infrastructure/adapters/redis-cache.adapter.ts
   â”œâ”€ infrastructure/adapters/memory-cache.adapter.ts
   â””â”€ Use Redis in prod, in-memory cache in tests

3. QUEUE/JOB PORT
   â”œâ”€ domain/ports/job-queue.port.ts
   â”œâ”€ infrastructure/adapters/bull-queue.adapter.ts
   â””â”€ Async payment processing, email batching, etc.

4. STORAGE PORT
   â”œâ”€ domain/ports/storage.port.ts
   â”œâ”€ infrastructure/adapters/aws-s3.adapter.ts
   â”œâ”€ infrastructure/adapters/local-filesystem.adapter.ts
   â””â”€ Store product images, receipts, etc.
